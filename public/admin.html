<!-- All changes are marked with ‚úÖ comments -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Top Gear Admin Panel</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
      max-width: 600px;
      margin: auto;
      background-color: #f8f8f8;
    }
    input, button {
      padding: 10px;
      margin: 5px 0;
      width: 100%;
    }
    .section {
      background: #fff;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    button {
      background-color: #ff5a30;
      color: #fff;
      border: none;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h2>üîê Admin Login</h2>
<div class="section section-login">
  <input id="username" ... />
  <input id="password" ... />
  <button onclick="login()">Login</button>
  <p id="login-status"></p>
</div>
<button onclick="logout()">Logout</button>


  <h2>‚ûï Add Car</h2>
  <div class="section">
    <input type="text" id="name" placeholder="Car Name" />
    <input type="text" id="price" placeholder="Price (‚ÇπX Lakh)" />
    <input type="number" id="year" placeholder="Year" />
    <input type="text" id="km" placeholder="Kilometers Driven" />
    <input type="text" id="fuel" placeholder="Fuel Type" />
    <input type="text" id="transmission" placeholder="Transmission" />
    <input type="text" id="category" placeholder="Category (SUV, Sedan...)" />
    <input type="text" id="image" placeholder="Image URL" />
    <button onclick="addCar()">Add Car</button>
    <p id="add-status"></p>
  </div>

  <h2>‚ùå Delete Car</h2>
  <div class="section">
    <input type="text" id="deleteId" placeholder="Car ID to Delete" />
    <button onclick="deleteCar()">Delete</button>
    <p id="delete-status"></p>
  </div>

  <script>
 const BASE_URL = 'https://top-gear-autos.onrender.com';
let token = localStorage.getItem("adminToken") || "";
let loggedInUser = localStorage.getItem("adminUser") || "";

if (token) {
  // ‚úÖ Already logged in ‚Äì show admin panel
  document.getElementById('login-status').textContent = `üëã Welcome back, ${loggedInUser}`;
  // Optionally: hide login section, show only admin tools
  document.querySelector('.section-login').style.display = 'none';
}


  // üîê Login Function
  function login() {
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;

    fetch(`${BASE_URL}/api/admin/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, password })
    })
      .then(res => res.json())
      .then(data => {
        console.log("üîê Login response:", data);

        if (data.success){
          token = data.token;
          localStorage.setItem("adminToken", token); // ‚úÖ Save token
          document.getElementById('login-status').textContent = '‚úÖ Login successful!';
        } else {
          document.getElementById('login-status').textContent = '‚ùå Invalid username or password';
        }
      })
      .catch(err => {
        document.getElementById('login-status').textContent = '‚ùå Login failed. Server error.';
        console.error("Login error:", err);
      });

    console.log("üì§ Sending login:", username, password);
  }

  // ‚ûï Add Car Function
  function addCar() {
    const car = {
      name: document.getElementById('name').value,
      price: document.getElementById('price').value,
      year: Number(document.getElementById('year').value),
      km: document.getElementById('km').value,
      fuel: document.getElementById('fuel').value,
      transmission: document.getElementById('transmission').value,
      category: document.getElementById('category').value,
      image: document.getElementById('image').value
    };

    fetch(`${BASE_URL}/api/cars`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer ' + token
      },
      body: JSON.stringify(car)
    })
      .then(async res => {
        const text = await res.text();
        try {
          const json = JSON.parse(text);
          if (json.success) {
            document.getElementById('add-status').textContent = '‚úÖ Car added!';
          } else {
            document.getElementById('add-status').textContent = '‚ùå Failed to add car';
          }
        } catch (err) {
          console.error("‚ùå Invalid JSON:", text);
          document.getElementById('add-status').textContent = '‚ùå Invalid server response';
        }
      })
      .catch(err => {
        document.getElementById('add-status').textContent = '‚ùå Add failed: ' + err.message;
        console.error("Add car error:", err);
      });
  }

  // ‚ùå Delete Car Function
  function deleteCar() {
    const id = document.getElementById('deleteId').value;

    fetch(`${BASE_URL}/api/cars/${id}`, {
      method: 'DELETE',
      headers: {
        'Authorization': 'Bearer ' + token
      }
    })
      .then(async res => {
        const text = await res.text();
        try {
          const json = JSON.parse(text);
          if (json.success) {
            document.getElementById('delete-status').textContent = '‚úÖ Car deleted!';
          } else {
            document.getElementById('delete-status').textContent = '‚ùå Failed to delete car';
          }
        } catch (err) {
          console.error("‚ùå Invalid JSON:", text);
          document.getElementById('delete-status').textContent = '‚ùå Invalid server response';
        }
      })
      .catch(err => {
        document.getElementById('delete-status').textContent = '‚ùå Delete failed: ' + err.message;
        console.error("Delete car error:", err);
      });
  }

    function logout() {
  localStorage.removeItem("adminToken");
  localStorage.removeItem("adminUser");
  location.reload(); // reload page to reset state
}


  </script>

</body>
</html>
